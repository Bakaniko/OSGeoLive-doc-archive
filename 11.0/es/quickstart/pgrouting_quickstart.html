<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Guía de inicio rápido de pgRouting &mdash; OSGeo-Live 11.0
 Documentation</title>
    
    <link rel="stylesheet" href="../../_static/overview.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '11.0
',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="OSGeo-Live 11.0
 Documentation" href="../../index.html" />
    <link rel="up" title="Quickstarts" href="toc.html" />
    <link rel="next" title="Guía de inicio rápido de PostGIS" href="postgis_quickstart.html" />
    <link rel="prev" title="Guía de inicio rápido de OTB" href="otb_quickstart.html" /> 
	<script type="text/javascript" src="../../_static/osgeolive.js"></script>

  </head>
  <body role="document">
    <div class="header">
	<div class="banner"><a href="http://live.osgeo.org/"><img src="../../_images/banner.png"></a></div>
        <div class="nowrap">
            <ul id="top-nav">
              <li><a href="../index.html">Home</a></li>
              <li><a href="../overview/overview.html">Contents</a></li>
              <!--li><a href="../standards/standards.html">Standards</a></li-->
              <li><a href="../download.html">Download</a></li>
              <li><a href="../metrics.html">Metrics</a></li>
              <li><a href="../sponsors.html">Sponsors</a></li>
              <li><a href="../contact.html">Contact Us</a></li>
            </ul>
        </div>
    </div>

    <div class="related">
	<font size="-2">
		<div id="translations">
		<!--
			<a href="../../en/index.html">English</a> |
			<a href="../../es/index.html">Español</a> |
			<a href="../../ca/index.html">Català</a> |
			<a href="../../fr/index.html">Français</a> |
			<a href="../../de/index.html">Deutsch</a> |
			<a href="../../it/index.html">Italiano</a> |
			<a href="../../pl/index.html">Polski</a> |
			<a href="../../el/index.html">Ελληνικά</a> |
			<a href="../../ru/index.html">Русский</a> |
			<a href="../../zh/index.html">中文</a> |
			<a href="../../id/index.html">Bahasa Indonesia</a> |
			<a href="../../ko/index.html">한국어</a> |
			<a href="../../ja/index.html">日本語</a>
		-->
		<!-- geo-order: West to East, UK to Japan -->
			<a href="javascript:defaultRedirect('en')">English</a> |
<!--			<a href="javascript:defaultRedirect('pt')">Portugus</a> | -->
			<a href="javascript:defaultRedirect('es')">Español</a> |
			<a href="javascript:defaultRedirect('ca')">Català</a> |
			<a href="javascript:defaultRedirect('fr')">Français</a> |
			<a href="javascript:defaultRedirect('de')">Deutsch</a> |
			<a href="javascript:defaultRedirect('it')">Italiano</a> |
			<a href="javascript:defaultRedirect('pl')">Polski</a> |
			<a href="javascript:defaultRedirect('el')">Ελληνικά</a> |
			<a href="javascript:defaultRedirect('ru')">Русский</a> |
			<a href="javascript:defaultRedirect('zh')">中文</a> |
<!--			<a href="javascript:defaultRedirect('id')">Bahasa Indonesia</a> | -->
			<a href="javascript:defaultRedirect('ko')">한국어</a> |
			<a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>


    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <a class="reference external image-reference" href="http://www.pgrouting.org"><img alt="pgRouting logo" class="align-right" src="../../_images/logo-pgRouting.png" style="width: 128.0px; height: 124.0px;" /></a>
<a class="reference external image-reference" href="http://www.osgeo.org"><img alt="OSGeo Community Project" class="align-right" src="../../_images/OSGeo_community.png" style="width: 150.0px; height: 53.0px;" /></a>
<div class="section" id="guia-de-inicio-rapido-de-pgrouting">
<h1>Guía de inicio rápido de pgRouting<a class="headerlink" href="#guia-de-inicio-rapido-de-pgrouting" title="Permalink to this headline">¶</a></h1>
<p>pgRouting es una extensión que añade ruteo y otras funcionalidades de análisis de redes a bases de datos <a class="reference internal" href="../overview/postgis_overview.html"><em>PostGIS</em></a>/<a class="reference external" href="http://www.postgresql.org">PostgreSQL</a>.</p>
<p>Esta guía rápida describe como habilitar pgrouting en una base de datos PostgreSQL, cargar datos con osm2pgrouting, y ejecutar una consulta básica con los datos de ejemplo para pruebas.</p>
<div class="section" id="habilitar-pgrouting-en-la-base-de-datos">
<h2>Habilitar pgRouting en la base de datos<a class="headerlink" href="#habilitar-pgrouting-en-la-base-de-datos" title="Permalink to this headline">¶</a></h2>
<p>En este ejemplo se crea la base de datos llamada <cite>city_routing</cite> y se habilita pgRouting en la base de datos.</p>
<ul class="simple">
<li>Abre la ventana <span class="menuselection">Applications ‣ Accessories ‣ Terminal</span> y ejecuta psql:</li>
</ul>
<p>(psql es una herramienta de línea de comandos empaquetada junto con PostgreSQL)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">psql</span>
</pre></div>
</div>
<p>En el promt de psql, teclear:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE DATABASE city_routing;
\connect city_routing;
CREATE EXTENSION postgis;
CREATE EXTENSION pgrouting;
</pre></div>
</div>
<p>Si estas usando PostgreSQL 9.6+, puedes omitir la linea <code class="code docutils literal"><span class="pre">CREATE</span> <span class="pre">EXTENSION</span> <span class="pre">postgis;</span></code> y usar <code class="code docutils literal"><span class="pre">CREATE</span> <span class="pre">EXTENSION</span> <span class="pre">pgrouting</span> <span class="pre">CASCADE;</span></code></p>
<p>Para verificar la instalación ejecutar:</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT  * FROM pgr_version();
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre> version |       tag       |  hash   | branch | boost
---------+-----------------+---------+--------+--------
 2.2.2   | pgrouting-2.2.2 | 7141904 | master | 1.59.0
(1 row)
</pre></div>
</div>
<p>La versión debe ser 2.1.0 o mayor para poder usar los ejemplos de esta guía rápida.</p>
</div>
<div class="section" id="cargar-datos-osm-usando-osm2pgrouting">
<h2>Cargar datos OSM usando osm2pgrouting<a class="headerlink" href="#cargar-datos-osm-usando-osm2pgrouting" title="Permalink to this headline">¶</a></h2>
<p>osm2pgorouting es una herramienta de linea de commando para cargar archivos <cite>.osm</cite> para ser compatibles con pgRouting.
Esta es la manera de usar osm2pgrouting version 2.1.0+</p>
<p>Primero verificar la versión de osm2pgrouting instalada, debe ser 2.1 o mayor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osm2pgrouting</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>El resultado muestra:</p>
<div class="highlight-python"><div class="highlight"><pre>This is osm2pgrouting Version 2.1
</pre></div>
</div>
<p>Cargar los datos de el archivo <cite>.osm</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre>cd
bzcat data/osm/feature_city.osm.bz2 &gt; /tmp/feature_city.osm
osm2pgrouting -f /tmp/feature_city.osm -h localhost -U user -d city_routing -p 5432 -W user --conf=/usr/share/osm2pgrouting/mapconfig_for_cars.xml
rm /tmp/feature_city.osm
</pre></div>
</div>
<p>La salida muestra algo como:</p>
<div class="highlight-python"><div class="highlight"><pre>Opening data file: feature_city.osm
    Parsing data

Spliting ways

Dropping tables...
NOTICE:  table &quot;ways&quot; does not exist, skipping
NOTICE:  table &quot;ways_vertices_pgr&quot; does not exist, skipping
NOTICE:  table &quot;relations_ways&quot; does not exist, skipping
Creating tables...
Creating &#39;ways_vertices_pgr&#39;: OK
   Adding Geometry: Creating &#39;ways&#39;: OK
   Adding Geometry: Creating &#39;relations_ways&#39;: OK
Creating &#39;osm_nodes&#39;: OK
   Adding Geometry: Creating &#39;osm_relations&#39;: OK
Creating &#39;osm_way_tags&#39;: OK
Creating &#39;osm_way_types&#39;: OK
Creating &#39;osm_way_classes&#39;: OK
Adding auxiliary tables to database...
    Processing 1 way types:  Inserted 1 way types
    Processing way&#39;s classes:  Inserted 16 way&#39;s classes
    Processing way&#39;s relations:  Inserted: 83874way&#39;s relations
    Processing way&#39;s tags:  Inserted 10455 way&#39;s tags
    Processing 10455 ways:
Vertices inserted 9165    Ways inserted: 10455
Creating topology...
#########################
size of streets: 4904
size of splitted ways : 10455
Execution started at: Tue Jun 21 17:57:57 2016
Execution ended at:   Tue Jun 21 17:58:02 2016
Elapsed time: 5.084 Seconds.
User CPU time: -&gt; 5.084 seconds
#########################
</pre></div>
</div>
</div>
<div class="section" id="ejecutando-pgrouting">
<h2>Ejecutando pgRouting<a class="headerlink" href="#ejecutando-pgrouting" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Abrir una ventana <span class="menuselection">Applications ‣ Accessories ‣ Terminal</span> y conectarse a la base de datos <code class="docutils literal"><span class="pre">city_routing</span></code>:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>psql -U postgres city_routing
</pre></div>
</div>
<ul class="simple">
<li>Teclea <strong class="command">\d</strong> y se mostrará la lista de todas las tablas disponibles:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>                    List of relations
 Schema |           Name           |   Type   |  Owner
--------+--------------------------+----------+----------
 public | geography_columns        | view     | postgres
 public | geometry_columns         | view     | postgres
 public | osm_nodes                | table    | postgres
 public | osm_nodes_node_id_seq    | sequence | postgres
 public | osm_relations            | table    | postgres
 public | osm_way_classes          | table    | postgres
 public | osm_way_tags             | table    | postgres
 public | osm_way_types            | table    | postgres
 public | raster_columns           | view     | postgres
 public | raster_overviews         | view     | postgres
 public | relations_ways           | table    | postgres
 public | spatial_ref_sys          | table    | postgres
 public | ways                     | table    | postgres
 public | ways_gid_seq             | sequence | postgres
 public | ways_vertices_pgr        | table    | postgres
 public | ways_vertices_pgr_id_seq | sequence | postgres
(16 rows)
</pre></div>
</div>
<ul class="simple">
<li>Ejecutar la función de el camino más corto de Dijkstra suponiendo un grafo sin dirección:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, node, edge, cost
        FROM pgr_dijkstra(&#39;
                SELECT gid as id, source, target,
                        length as cost FROM ways&#39;,
                100, 600, false
        );
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre> seq | node | edge  |         cost
-----+------+-------+-----------------------
   1 |  100 |   148 |  0.000106201177015572
   2 | 3603 |  4118 |  0.000171096610136435
   3 | 8284 |  9429 |  0.000101401380664492
 ... |  ... |   ... |                 ...
  37 | 3461 |  3964 |   0.00121559903339768
  38 | 1761 |  2013 |   0.00307553090376563
  39 | 5981 |  6801 |  0.000158813884783759
  40 |  600 |    -1 |                     0
(40 rows)
</pre></div>
</div>
<p>pgr_dijkstra también apoya <code class="code docutils literal"><span class="pre">bigint</span></code> para identificadores de nodos y segmentos, igualmente osm2pgrouting carga
los identificadores osm_id,
por lo que alternativamente se puede usar el osm_id en vez de el auto-generado <cite>source</cite> y <cite>target</cite> para los nodos.
Para buscar los correspondientes osm_ids para los nodos, usar esta consulta:</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT id, osm_id
        FROM ways_vertices_pgr where id IN( 100, 600);
</pre></div>
</div>
<p>Which outputs:</p>
<div class="highlight-python"><div class="highlight"><pre> id  |   osm_id
-----+------------
 100 | 1896068597
 600 |   31369798
(2 rows)
</pre></div>
</div>
<ul class="simple">
<li>Ejecutar la función de el camino más corto de Dijkstra suponiendo un grafo sin dirección usando identificadores OSM.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, node, edge, cost
FROM pgr_dijkstra(&#39;
        SELECT gid as id, source_osm AS source, target_osm AS target,
                length as cost FROM ways&#39;,
        1896068597, 31369798, false
);
</pre></div>
</div>
<p>Nota: La sub-consulta SQL debe llevar siempre los campos <cite>id, source, target, and cost</cite>.
Como se están usando campos <cite>source_osm</cite> y <cite>target_osm</cite>, se necesita crear un alias para que correspondan a las columnas <cite>source</cite> y <cite>target</cite>.</p>
<p>El resultado es:</p>
<div class="highlight-python"><div class="highlight"><pre> seq |    node    | edge  |         cost
-----+------------+-------+-----------------------
   1 | 1896068597 |   148 |  0.000106201177015572
   2 |  471372588 |  4118 |  0.000171096610136435
   3 |  471372583 |  9429 |  0.000101401380664492
   :
   :
  ...|  ...       |   ... |                 ...
  37 | 1370351630 |  3964 |   0.00121559903339768
  38 |   30812815 |  2013 |   0.00307553090376563
  39 | 3214028631 |  6801 |  0.000158813884783759
  40 |   31369798 |    -1 |                     0
(40 rows)
</pre></div>
</div>
<p>Debido a que se está  usando identificadores para los segmentos que son auto generados,
los números en la columna <cite>edge`</cite> son los mismos que en la consulta anterior,
pero los números en <cite>node</cite> son los identificadores de OSM.</p>
<p>El beneficio de usar los identificadores de OSM vs los identificadores autogenerados es, que los
resultados van a ser consistentes entre las diferentes bases de datos si manejan un conjunto comun de datos OSM.
No todas las funciones han sido cambiadas para el uso de bigint, por lo que no en todas se puede usar
el identificador OSM.</p>
<ul class="simple">
<li>Para generar la gemetría de una ruta, hay que ligar el resultado con las geometrías de los caminos:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, edge, rpad(b.the_geom::text,60,&#39; &#39;) AS &quot;the_geom (truncated)&quot;
        FROM pgr_dijkstra(&#39;
                SELECT gid as id, source, target,
                        length as cost FROM ways&#39;,
                100, 600, false
        ) a INNER JOIN ways b ON (a.edge = b.gid) ORDER BY seq;
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre> seq | edge  |                     the_geom (truncated)
-----+-------+--------------------------------------------------------------
   1 |   148 | 0102000020E61000000200000035BEE5A03A641C40BC98C1734A5E4940F4
   2 |  4118 | 0102000020E610000002000000F4CE577F3A641C402B5CA0EE4D5E494058
   3 |  9429 | 0102000020E61000000200000058BCA2A53C641C40C3503D88535E4940F5
 ... |   ... |                                                          ...
  36 |  6538 | 0102000020E6100000020000002999F7938C6F1C409DD843FB585D49405C
  37 |  3964 | 0102000020E6100000020000005CAE7E6C926F1C40E55C2FF2575D494088
  38 |  2013 | 0102000020E6100000020000008849B89047701C406DF7BC2C375D4940E8
  39 |  6801 | 0102000020E610000002000000E82E89B322721C40A85890C1E55C494059
(39 rows)
</pre></div>
</div>
<ul class="simple">
<li>Para ver las rutas usar en una herramienta gráfica
como <a class="reference internal" href="../overview/openjump_overview.html"><em>OpenJump</em></a> o como
la extensión <cite>DBmanager</cite> de <a class="reference internal" href="../overview/qgis_overview.html"><em>QGIS</em></a></li>
</ul>
<p>Para usar la extensión DBmanager de Qgis: abrir Qgis e ir a <span class="menuselection">Database ‣ DB Manager ‣ DB Manager</span>.
Seleccionar el icono <cite>SQL Window</cite> finalmente cortar y pegar la consulta anterior.</p>
<ul class="simple">
<li>Ejecutar la función del camino más corto de Dijkstra considerando grafo con dirección.</li>
</ul>
<p>En los ejemplos previos, se supuso que los segmentos o calles tienen igual costo en ambas direcciones.
Para casos donde existen caminos de un solo sentido, o distintas velocidades en ambos sentidos,
el costo de ir en una dirección del camino puede ser differente al de ir en la dirección opuesta.
Para estos casos se necesita una columna adicional a la sub-consulta <cite>reverse_cost</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, node, edge, cost
        FROM pgr_dijkstra(&#39;
                SELECT gid as id, source, target,
                        cost_s As cost, reverse_cost_s AS reverse_cost FROM ways&#39;,
                100, 600, true
        );
</pre></div>
</div>
<ul class="simple">
<li>Usa <strong class="command">\q</strong> para salir del psql.</li>
</ul>
</div>
<div class="section" id="que-sigue">
<h2>Que sigue?<a class="headerlink" href="#que-sigue" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>pgRouting Website</strong> - Visita el itio Web del projecto <a class="reference external" href="http://www.pgrouting.org">http://www.pgrouting.org</a> para aprender más sobre pgRouting.</li>
<li><strong>pgRouting Documentation</strong> - Ve la documentatión más reciente en <a class="reference external" href="http://docs.pgrouting.org">http://docs.pgrouting.org</a></li>
<li><strong>pgRouting Workshop</strong> - El taller <cite>&#8220;FOSS4G routing with pgRouting tools and OpenStreetMap road data&#8221;</cite> está disponible en: <a class="reference external" href="http://workshop.pgrouting.org">http://workshop.pgrouting.org</a></li>
<li><strong>osm2pgRouting loading data</strong> - <a class="reference external" href="https://github.com/pgRouting/osm2pgrouting/wiki/Documentation-for-osm2pgrouting-v2.1">https://github.com/pgRouting/osm2pgrouting/wiki/Documentation-for-osm2pgrouting-v2.1</a></li>
<li><strong>QGIS pgRouting Layer Plugin</strong> - <a class="reference external" href="https://plugins.qgis.org/plugins/pgRoutingLayer/">https://plugins.qgis.org/plugins/pgRoutingLayer/</a> proviee un GUI para las functiones de pgRouting e interactúa con el mapa de esta forma no escribes consultas SQL.</li>
</ul>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
	<font size="-2">
		<div id="translations">
		<!--
			<a href="../../en/index.html">English</a> |
			<a href="../../es/index.html">Español</a> |
			<a href="../../ca/index.html">Català</a> |
			<a href="../../fr/index.html">Français</a> |
			<a href="../../de/index.html">Deutsch</a> |
			<a href="../../it/index.html">Italiano</a> |
			<a href="../../pl/index.html">Polski</a> |
			<a href="../../el/index.html">Ελληνικά</a> |
			<a href="../../ru/index.html">Русский</a> |
			<a href="../../zh/index.html">中文</a> |
			<a href="../../id/index.html">Bahasa Indonesia</a> |
			<a href="../../ko/index.html">한국어</a> |
			<a href="../../ja/index.html">日本語</a>
		-->
		<!-- geo-order: West to East, UK to Japan -->
			<a href="javascript:defaultRedirect('en')">English</a> |
<!--			<a href="javascript:defaultRedirect('pt')">Portugus</a> | -->
			<a href="javascript:defaultRedirect('es')">Español</a> |
			<a href="javascript:defaultRedirect('ca')">Català</a> |
			<a href="javascript:defaultRedirect('fr')">Français</a> |
			<a href="javascript:defaultRedirect('de')">Deutsch</a> |
			<a href="javascript:defaultRedirect('it')">Italiano</a> |
			<a href="javascript:defaultRedirect('pl')">Polski</a> |
			<a href="javascript:defaultRedirect('el')">Ελληνικά</a> |
			<a href="javascript:defaultRedirect('ru')">Русский</a> |
			<a href="javascript:defaultRedirect('zh')">中文</a> |
<!--			<a href="javascript:defaultRedirect('id')">Bahasa Indonesia</a> | -->
			<a href="javascript:defaultRedirect('ko')">한국어</a> |
			<a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>

<span style="font-size:85%;"><i><a href="../copyright.html">Copyright & Disclaimer</a></i></span>

  </body>
</html>