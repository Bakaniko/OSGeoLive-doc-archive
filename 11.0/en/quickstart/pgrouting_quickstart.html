<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pgRouting Quickstart &mdash; OSGeo-Live 11.0
 Documentation</title>
    
    <link rel="stylesheet" href="../../_static/overview.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '11.0
',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="OSGeo-Live 11.0
 Documentation" href="../../index.html" />
    <link rel="up" title="Quickstarts" href="toc.html" />
    <link rel="next" title="PostGIS Quickstart" href="postgis_quickstart.html" />
    <link rel="prev" title="OTB Quickstart" href="otb_quickstart.html" /> 
	<script type="text/javascript" src="../../_static/osgeolive.js"></script>

  </head>
  <body role="document">
    <div class="header">
	<div class="banner"><a href="http://live.osgeo.org/"><img src="../../_images/banner.png"></a></div>
        <div class="nowrap">
            <ul id="top-nav">
              <li><a href="../index.html">Home</a></li>
              <li><a href="../overview/overview.html">Contents</a></li>
              <!--li><a href="../standards/standards.html">Standards</a></li-->
              <li><a href="../download.html">Download</a></li>
              <li><a href="../metrics.html">Metrics</a></li>
              <li><a href="../sponsors.html">Sponsors</a></li>
              <li><a href="../contact.html">Contact Us</a></li>
            </ul>
        </div>
    </div>

    <div class="related">
	<font size="-2">
		<div id="translations">
		<!--
			<a href="../../en/index.html">English</a> |
			<a href="../../es/index.html">Español</a> |
			<a href="../../ca/index.html">Català</a> |
			<a href="../../fr/index.html">Français</a> |
			<a href="../../de/index.html">Deutsch</a> |
			<a href="../../it/index.html">Italiano</a> |
			<a href="../../pl/index.html">Polski</a> |
			<a href="../../el/index.html">Ελληνικά</a> |
			<a href="../../ru/index.html">Русский</a> |
			<a href="../../zh/index.html">中文</a> |
			<a href="../../id/index.html">Bahasa Indonesia</a> |
			<a href="../../ko/index.html">한국어</a> |
			<a href="../../ja/index.html">日本語</a>
		-->
		<!-- geo-order: West to East, UK to Japan -->
			<a href="javascript:defaultRedirect('en')">English</a> |
<!--			<a href="javascript:defaultRedirect('pt')">Portugus</a> | -->
			<a href="javascript:defaultRedirect('es')">Español</a> |
			<a href="javascript:defaultRedirect('ca')">Català</a> |
			<a href="javascript:defaultRedirect('fr')">Français</a> |
			<a href="javascript:defaultRedirect('de')">Deutsch</a> |
			<a href="javascript:defaultRedirect('it')">Italiano</a> |
			<a href="javascript:defaultRedirect('pl')">Polski</a> |
			<a href="javascript:defaultRedirect('el')">Ελληνικά</a> |
			<a href="javascript:defaultRedirect('ru')">Русский</a> |
			<a href="javascript:defaultRedirect('zh')">中文</a> |
<!--			<a href="javascript:defaultRedirect('id')">Bahasa Indonesia</a> | -->
			<a href="javascript:defaultRedirect('ko')">한국어</a> |
			<a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>


    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <a class="reference external image-reference" href="http://www.pgrouting.org"><img alt="pgRouting logo" class="align-right" src="../../_images/logo-pgRouting.png" style="width: 128.0px; height: 124.0px;" /></a>
<a class="reference external image-reference" href="http://www.osgeo.org"><img alt="OSGeo Community Project" class="align-right" src="../../_images/OSGeo_community.png" style="width: 150.0px; height: 53.0px;" /></a>
<div class="section" id="pgrouting-quickstart">
<h1><a class="toc-backref" href="#id1">pgRouting Quickstart</a><a class="headerlink" href="#pgrouting-quickstart" title="Permalink to this headline">¶</a></h1>
<p>pgRouting is an extension that adds routing and other network analysis functionality to <a class="reference internal" href="../overview/postgis_overview.html"><em>PostGIS</em></a>/<a class="reference external" href="http://www.postgresql.org">PostgreSQL</a> databases.</p>
<p>This Quick Start describes how to enable pgrouting in a PostgreSQL database, load data with osm2pgrouting, and run a basic shortest path query with the sample test data.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#pgrouting-quickstart" id="id1">pgRouting Quickstart</a><ul>
<li><a class="reference internal" href="#enabling-pgrouting-in-a-database" id="id2">Enabling pgRouting in a database</a></li>
<li><a class="reference internal" href="#loading-osm-data-with-osm2pgrouting" id="id3">Loading OSM data with osm2pgrouting</a></li>
<li><a class="reference internal" href="#running-pgrouting" id="id4">Running pgRouting</a></li>
<li><a class="reference internal" href="#what-next" id="id5">What next?</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="enabling-pgrouting-in-a-database">
<h2><a class="toc-backref" href="#id2">Enabling pgRouting in a database</a><a class="headerlink" href="#enabling-pgrouting-in-a-database" title="Permalink to this headline">¶</a></h2>
<p>In this example we will create a database called <cite>city_routing</cite> and enable pgRouting in the database.</p>
<ul class="simple">
<li>Open a <span class="menuselection">Applications ‣ Accessories ‣ Terminal</span> window and open up psql: (psql is the commandline tool packaged with PostgreSQL)</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">psql</span>
</pre></div>
</div>
<p>At psql prompt type:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE DATABASE city_routing;
\connect city_routing;
CREATE EXTENSION postgis;
CREATE EXTENSION pgrouting;
</pre></div>
</div>
<p>If you are running PostgreSQL 9.6+, you can skip the postgis line and do <code class="code docutils literal"><span class="pre">CREATE</span> <span class="pre">EXTENSION</span> <span class="pre">pgrouting</span> <span class="pre">CASCADE;</span></code></p>
<p>You can verify your installation by running this:</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT  * FROM pgr_version();
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre> version |  tag   |   hash    | branch | boost
---------+--------+-----------+--------+--------
 2.3.2   | v2.3.2 | 1f2af3c52 | master | 1.58.0
(1 row)
</pre></div>
</div>
<p>Your version should be 2.1.0 or higher to use examples in this quickstart.</p>
</div>
<div class="section" id="loading-osm-data-with-osm2pgrouting">
<h2><a class="toc-backref" href="#id3">Loading OSM data with osm2pgrouting</a><a class="headerlink" href="#loading-osm-data-with-osm2pgrouting" title="Permalink to this headline">¶</a></h2>
<p>osm2pgorouting is a command-line tool for loading .osm files into pgRouting compatible format.
Here is how you use osm2pgrouting version 2.1.0+</p>
<p>First verify version of osm2pgrouting you have installed. Should read 2.1 or higher.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">osm2pgrouting</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>Output shows:</p>
<div class="highlight-python"><div class="highlight"><pre>This is osm2pgrouting Version 2.2
</pre></div>
</div>
<p>Now load the data from osm file</p>
<div class="highlight-python"><div class="highlight"><pre>cd
bzcat data/osm/feature_city.osm.bz2 &gt; /tmp/feature_city.osm
osm2pgrouting -f /tmp/feature_city.osm -h localhost -U user -d city_routing -p 5432 -W user --conf=/usr/share/osm2pgrouting/mapconfig_for_cars.xml
rm /tmp/feature_city.osm
</pre></div>
</div>
<p>Output should be something like:</p>
<div class="highlight-python"><div class="highlight"><pre>Export Ways ...
    Processing 45383 ways:
[*************************************************| ] (99%)    Ways Processed: 45383        Split Ways generated: 10483 Vertices inserted 9165 Inserted 10483 split ways
Creating Foreign Keys ...
Foreign keys for osm_way_classes table created
Foreign keys for relations_ways table created
Foreign keys for Ways table created
#########################
size of streets: 45383
#########################
</pre></div>
</div>
</div>
<div class="section" id="running-pgrouting">
<h2><a class="toc-backref" href="#id4">Running pgRouting</a><a class="headerlink" href="#running-pgrouting" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Open a <span class="menuselection">Applications ‣ Accessories ‣ Terminal</span> window and connect to the <code class="docutils literal"><span class="pre">city_routing</span></code> database:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>psql -U postgres city_routing
</pre></div>
</div>
<ul class="simple">
<li>Type <strong class="command">\d</strong> will list you all available tables:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>                    List of relations
 Schema |           Name           |   Type   |  Owner
--------+--------------------------+----------+----------
 public | geography_columns        | view     | postgres
 public | geometry_columns         | view     | postgres
 public | osm_nodes                | table    | postgres
 public | osm_nodes_node_id_seq    | sequence | postgres
 public | osm_relations            | table    | postgres
 public | osm_way_classes          | table    | postgres
 public | osm_way_types            | table    | postgres
 public | raster_columns           | view     | postgres
 public | raster_overviews         | view     | postgres
 public | relations_ways           | table    | postgres
 public | spatial_ref_sys          | table    | postgres
 public | ways                     | table    | postgres
 public | ways_gid_seq             | sequence | postgres
 public | ways_vertices_pgr        | table    | postgres
 public | ways_vertices_pgr_id_seq | sequence | postgres
(15 rows)
</pre></div>
</div>
<ul class="simple">
<li>Run the Dijkstra shortest path function assuming undirected travel:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, node, edge, cost
        FROM pgr_dijkstra(&#39;
                SELECT gid as id, source, target,
                        length as cost FROM ways&#39;,
                100, 600, false
        );
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre> seq | node | edge  |         cost
-----+------+-------+-----------------------
   1 |  100 |   148 |  0.000106201177015572
   2 | 3603 |  4118 |  0.000171096610136435
   3 | 8284 |  9429 |  0.000101401380664492
 ... |  ... |   ... |                 ...
  37 | 3461 |  3964 |   0.00121559903339768
  38 | 1761 |  2013 |   0.00307553090376563
  39 | 5981 |  6801 |  0.000158813884783759
  40 |  600 |    -1 |                     0
(40 rows)
</pre></div>
</div>
<p>pgr_dijkstra also supports bigints for nodes and edges, and osm2pgrouting loads the osm_ids as well, so you
could alternatively use the osm_id instead of the autogenerated source and targets for nodes.
To look up the corresponding osm_ids for our nodes, we would use this query:</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT id, osm_id
        FROM ways_vertices_pgr where id IN( 100, 600);
</pre></div>
</div>
<p>Which outputs:</p>
<div class="highlight-python"><div class="highlight"><pre> id  |   osm_id
-----+------------
 100 | 1896068597
 600 |   31369798
(2 rows)
</pre></div>
</div>
<p>To do so you would change
your query to below:</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, node, edge, cost
FROM pgr_dijkstra(&#39;
        SELECT gid as id, source_osm AS source, target_osm AS target,
                length as cost FROM ways&#39;,
        1896068597, 31369798, false
);
</pre></div>
</div>
<p>Note: the SQL statement must always have field names <cite>id, source, target, and cost</cite>.
Since we are using fields <cite>source_osm</cite> and <cite>target_osm</cite>, we need to alias them so resulting pgr_dijkstra query columns are named source and target</p>
<p>Output is:</p>
<div class="highlight-python"><div class="highlight"><pre> seq |    node    | edge  |         cost
-----+------------+-------+-----------------------
   1 | 1896068597 |   148 |  0.000106201177015572
   2 |  471372588 |  4118 |  0.000171096610136435
   3 |  471372583 |  9429 |  0.000101401380664492
   :
   :
  ...|  ...       |   ... |                 ...
  37 | 1370351630 |  3964 |   0.00121559903339768
  38 |   30812815 |  2013 |   0.00307553090376563
  39 | 3214028631 |  6801 |  0.000158813884783759
  40 |   31369798 |    -1 |                     0
(40 rows)
</pre></div>
</div>
<p>Since we are still using autogenerated edge ids, our edge numbers are the same as our previous query,
but the nodes are the osm node ids.</p>
<p>The benefit of using the osm_ids instead of the auto-generated ids is that your results will be consistent
between different databases if they share a common set of osm ids.  Not all pgRouting functions have
been changed to use bigints, so osm_ids can&#8217;t be used with all functions.</p>
<ul class="simple">
<li>To output the route geometry, link the result with the road geometries:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, edge, rpad(b.the_geom::text,60,&#39; &#39;) AS &quot;the_geom (truncated)&quot;
        FROM pgr_dijkstra(&#39;
                SELECT gid as id, source, target,
                        length as cost FROM ways&#39;,
                100, 600, false
        ) a INNER JOIN ways b ON (a.edge = b.gid) ORDER BY seq;
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre> seq | edge  |                     the_geom (truncated)
-----+-------+--------------------------------------------------------------
   1 |   148 | 0102000020E61000000200000035BEE5A03A641C40BC98C1734A5E4940F4
   2 |  4118 | 0102000020E610000002000000F4CE577F3A641C402B5CA0EE4D5E494058
   3 |  9429 | 0102000020E61000000200000058BCA2A53C641C40C3503D88535E4940F5
 ... |   ... |                                                          ...
  36 |  6538 | 0102000020E6100000020000002999F7938C6F1C409DD843FB585D49405C
  37 |  3964 | 0102000020E6100000020000005CAE7E6C926F1C40E55C2FF2575D494088
  38 |  2013 | 0102000020E6100000020000008849B89047701C406DF7BC2C375D4940E8
  39 |  6801 | 0102000020E610000002000000E82E89B322721C40A85890C1E55C494059
(39 rows)
</pre></div>
</div>
<ul>
<li><dl class="first docutils">
<dt>You can view the routes using a graphical tool</dt>
<dd><p class="first last">such as <a class="reference internal" href="../overview/openjump_overview.html"><em>OpenJump</em></a> or
the <a class="reference internal" href="../overview/qgis_overview.html"><em>QGIS</em></a> DbManager extension.</p>
</dd>
</dl>
</li>
</ul>
<p>To use the DbManager extension of QGIS open up QGIS then go to Go to <code class="docutils literal"><span class="pre">Database</span> <span class="pre">-&gt;</span> <span class="pre">DB</span> <span class="pre">Manager</span> <span class="pre">-&gt;</span> <span class="pre">DB</span> <span class="pre">Manager</span></code>.
Select the SQL Window icon and cut and paste the above pgRouting Query.</p>
<ul class="simple">
<li>Run the Dijkstra shortest path function with considering direction.</li>
</ul>
<p>In the previous examples, we assumed streets have equal cost in both directions.
For cases where you have one ways or different speed limits on either lane,
cost going on one direction of a road, may be different than going the other way.
For these cases you need to add an additional column to your query <cite>reverse_cost</cite></p>
<div class="highlight-python"><div class="highlight"><pre>SELECT seq, node, edge, cost
        FROM pgr_dijkstra(&#39;
                SELECT gid as id, source, target,
                        cost_s As cost, reverse_cost_s AS reverse_cost FROM ways&#39;,
                100, 600, true
        );
</pre></div>
</div>
<ul class="simple">
<li>With <strong class="command">\q</strong> command leave the PostgreSQL shell.</li>
</ul>
</div>
<div class="section" id="what-next">
<h2><a class="toc-backref" href="#id5">What next?</a><a class="headerlink" href="#what-next" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>pgRouting Website</strong> - Visit the project website <a class="reference external" href="http://www.pgrouting.org">http://www.pgrouting.org</a> to learn more about pgRouting.</li>
<li><strong>pgRouting Documentation</strong> - Find the most recent documentation in <a class="reference external" href="http://docs.pgrouting.org">http://docs.pgrouting.org</a></li>
<li><strong>pgRouting Workshop</strong> - The workshop <cite>&#8220;FOSS4G routing with pgRouting tools and OpenStreetMap road data&#8221;</cite> is available in: <a class="reference external" href="http://workshop.pgrouting.org">http://workshop.pgrouting.org</a></li>
<li><strong>osm2pgRouting loading data</strong> - <a class="reference external" href="https://github.com/pgRouting/osm2pgrouting/wiki/Documentation-for-osm2pgrouting-v2.1">https://github.com/pgRouting/osm2pgrouting/wiki/Documentation-for-osm2pgrouting-v2.1</a></li>
<li><strong>QGIS pgRouting Layer Plugin</strong> - <a class="reference external" href="https://plugins.qgis.org/plugins/pgRoutingLayer/">https://plugins.qgis.org/plugins/pgRoutingLayer/</a> provides GUI for pgRouting functions and interacts with map so you don&#8217;t have to write SQL.</li>
</ul>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
	<font size="-2">
		<div id="translations">
		<!--
			<a href="../../en/index.html">English</a> |
			<a href="../../es/index.html">Español</a> |
			<a href="../../ca/index.html">Català</a> |
			<a href="../../fr/index.html">Français</a> |
			<a href="../../de/index.html">Deutsch</a> |
			<a href="../../it/index.html">Italiano</a> |
			<a href="../../pl/index.html">Polski</a> |
			<a href="../../el/index.html">Ελληνικά</a> |
			<a href="../../ru/index.html">Русский</a> |
			<a href="../../zh/index.html">中文</a> |
			<a href="../../id/index.html">Bahasa Indonesia</a> |
			<a href="../../ko/index.html">한국어</a> |
			<a href="../../ja/index.html">日本語</a>
		-->
		<!-- geo-order: West to East, UK to Japan -->
			<a href="javascript:defaultRedirect('en')">English</a> |
<!--			<a href="javascript:defaultRedirect('pt')">Portugus</a> | -->
			<a href="javascript:defaultRedirect('es')">Español</a> |
			<a href="javascript:defaultRedirect('ca')">Català</a> |
			<a href="javascript:defaultRedirect('fr')">Français</a> |
			<a href="javascript:defaultRedirect('de')">Deutsch</a> |
			<a href="javascript:defaultRedirect('it')">Italiano</a> |
			<a href="javascript:defaultRedirect('pl')">Polski</a> |
			<a href="javascript:defaultRedirect('el')">Ελληνικά</a> |
			<a href="javascript:defaultRedirect('ru')">Русский</a> |
			<a href="javascript:defaultRedirect('zh')">中文</a> |
<!--			<a href="javascript:defaultRedirect('id')">Bahasa Indonesia</a> | -->
			<a href="javascript:defaultRedirect('ko')">한국어</a> |
			<a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>

<span style="font-size:85%;"><i><a href="../copyright.html">Copyright & Disclaimer</a></i></span>

  </body>
</html>